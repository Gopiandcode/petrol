<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Expr (petrol.Petrol.Expr)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">petrol</a> &#x00BB; <a href="../index.html">Petrol</a> &#x00BB; Expr</nav><header class="odoc-preamble"><h1>Module <code><span>Petrol.Expr</span></code></h1><p>Provides an SQL E-DSL for writing well-typed SQL expressions.</p></header><nav class="odoc-toc"><ul><li><a href="#constants">Constants</a></li><li><a href="#book-keeping:-types,-naming,-nulls">Book-keeping: Types, Naming, Nulls</a></li><li><a href="#operators">Operators</a></li><li><a href="#functions">Functions</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a t</span></span></code></div><div class="spec-doc"><p><code>'a t</code> represents an SQL expression that produces a value corresponding to the type <code>'a</code>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-expr_list"><a href="#type-expr_list" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a expr_list</span></span><span> = </span></code><ol><li id="type-expr_list.[]" class="def variant constructor anchored"><a href="#type-expr_list.[]" class="anchor"></a><code><span>| </span><span><span class="constructor">[]</span> : <span>unit <a href="#type-expr_list">expr_list</a></span></span></code></li><li id="type-expr_list.::" class="def variant constructor anchored"><a href="#type-expr_list.::" class="anchor"></a><code><span>| </span><span><span class="constructor">::</span> : <span>(<span><span class="type-var">'a</span> <a href="#type-t">t</a></span> * <span><span class="type-var">'b</span> <a href="#type-expr_list">expr_list</a></span>)</span> <span class="arrow">&#45;&gt;</span> <span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span>)</span> <a href="#type-expr_list">expr_list</a></span></span></code></li></ol></div><div class="spec-doc"><p>Represents a heterogeneous sequence of SQL expressions.</p><p><b>Note</b> Provided you have opened the Expr module, you can use List syntax to construct such lists:</p><pre class="language-ocaml"><code>Petrol.Expr.[i 1; bl false]
(* - : (int * (bool * ())) Petrol.Expr.expr_list *)</code></pre></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-wrapped_assign"><a href="#type-wrapped_assign" class="anchor"></a><code><span><span class="keyword">type</span> wrapped_assign</span></code></div><div class="spec-doc"><p>An opaque wrapper that represents an assignment of a value to a particular field in a table.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp"><a href="#val-pp" class="anchor"></a><code><span><span class="keyword">val</span> pp : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>pp fmt expr</code> pretty prints an SQL expression as a string that can be parsed by an SQL engine.</p></div></div><h2 id="constants"><a href="#constants" class="anchor"></a>Constants</h2><p>The following functions define constant value expressions.</p><p><b>Note</b> For each type, there are two flavours of constant expression: variable and static.</p><p>The key difference between the two is in terms of how they are represented in the final SQL query - in particular, variable constant expressions are encoded as holes (?) in the query, to which a constant value is supplied, whereas static constant expressions are encoded directly in the query string.</p><p>As Petrol functions cache the construction of SQL queries by their final string representation, you should prefer the dynamic form if you expect the constant value to change frequently - for example, if it is a constant value that you are receiving from elsewhere. Use the static form if you know that the value doesn't change and will always be the same.</p><div class="odoc-spec"><div class="spec value anchored" id="val-i"><a href="#val-i" class="anchor"></a><code><span><span class="keyword">val</span> i : <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>i v</code> returns an expression that evaluates to the integer value <code>v</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-f"><a href="#val-f" class="anchor"></a><code><span><span class="keyword">val</span> f : <span>float <span class="arrow">&#45;&gt;</span></span> <span>float <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>f v</code> returns an expression that evaluates to the real value <code>v</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-s"><a href="#val-s" class="anchor"></a><code><span><span class="keyword">val</span> s : <span>string <span class="arrow">&#45;&gt;</span></span> <span>string <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>s v</code> returns an expression that evaluates to the string value <code>v</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-b"><a href="#val-b" class="anchor"></a><code><span><span class="keyword">val</span> b : <span>string <span class="arrow">&#45;&gt;</span></span> <span>string <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>b v</code> returns an expression that evaluates to the bytes value <code>v</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bl"><a href="#val-bl" class="anchor"></a><code><span><span class="keyword">val</span> bl : <span>bool <span class="arrow">&#45;&gt;</span></span> <span>bool <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>bl v</code> returns an expression that evaluates to the bool value <code>v</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-i_stat"><a href="#val-i_stat" class="anchor"></a><code><span><span class="keyword">val</span> i_stat : <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>i_stat v</code> returns a static expression that evaluates to the integer value <code>v</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-f_stat"><a href="#val-f_stat" class="anchor"></a><code><span><span class="keyword">val</span> f_stat : <span>float <span class="arrow">&#45;&gt;</span></span> <span>float <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>f_stat v</code> returns a static expression that evaluates to the real value <code>v</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-s_stat"><a href="#val-s_stat" class="anchor"></a><code><span><span class="keyword">val</span> s_stat : <span>string <span class="arrow">&#45;&gt;</span></span> <span>string <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>s_stat v</code> returns a static expression that evaluates to the string value <code>v</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-b_stat"><a href="#val-b_stat" class="anchor"></a><code><span><span class="keyword">val</span> b_stat : <span>string <span class="arrow">&#45;&gt;</span></span> <span>string <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>b_stat v</code> returns a static expression that evaluates to the bytes value <code>v</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-true_"><a href="#val-true_" class="anchor"></a><code><span><span class="keyword">val</span> true_ : <span>bool <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>true_</code> represents the SQL constant <code>TRUE</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-false_"><a href="#val-false_" class="anchor"></a><code><span><span class="keyword">val</span> false_ : <span>bool <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>false_</code> represents the SQL constant <code>FALSE</code>.</p></div></div><h2 id="book-keeping:-types,-naming,-nulls"><a href="#book-keeping:-types,-naming,-nulls" class="anchor"></a>Book-keeping: Types, Naming, Nulls</h2><div class="odoc-spec"><div class="spec value anchored" id="val-as_"><a href="#val-as_" class="anchor"></a><code><span><span class="keyword">val</span> as_ : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>name:string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span> * <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>as_ exp ~name</code> returns a tuple <code>(exp',exp'_ref)</code> where <code>exp'</code> is the SQL expression <code>exp AS name</code> that names <code>exp</code> as <code>name</code>, and <code>exp'_ref</code> is simply <code>name</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-nullable"><a href="#val-nullable" class="anchor"></a><code><span><span class="keyword">val</span> nullable : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> option</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>nullable e</code> encodes the fact that the expression <code>e</code> may return <code>NULL</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_not_null"><a href="#val-is_not_null" class="anchor"></a><code><span><span class="keyword">val</span> is_not_null : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>bool <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>is_not_null e</code> constructs an SQL expression that is <code>TRUE</code> iff the expression <code>e</code> is not <code>NULL</code> and <code>FALSE</code> otherwise.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-coerce"><a href="#val-coerce" class="anchor"></a><code><span><span class="keyword">val</span> coerce : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="../Type/index.html#type-t">Type.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>coerce expr ty</code> coerces expression <code>expr</code> to the type <code>ty</code>. This coercion is not checked, so make sure you know what you're doing or it could fail at runtime.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(:=)"><a href="#val-(:=)" class="anchor"></a><code><span><span class="keyword">val</span> (:=) : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-wrapped_assign">wrapped_assign</a></span></code></div><div class="spec-doc"><p><code>v := expr</code> returns an SQL expression that can be used with an update or insert clause to change the values in the database.</p></div></div><h2 id="operators"><a href="#operators" class="anchor"></a>Operators</h2><div class="odoc-spec"><div class="spec value anchored" id="val-(+)"><a href="#val-(+)" class="anchor"></a><code><span><span class="keyword">val</span> (+) : <span><span>int <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>int <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(-)"><a href="#val-(-)" class="anchor"></a><code><span><span class="keyword">val</span> (-) : <span><span>int <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>int <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(=)"><a href="#val-(=)" class="anchor"></a><code><span><span class="keyword">val</span> (=) : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>bool <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(&lt;&gt;)"><a href="#val-(&lt;&gt;)" class="anchor"></a><code><span><span class="keyword">val</span> (&lt;&gt;) : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>bool <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(&lt;=)"><a href="#val-(&lt;=)" class="anchor"></a><code><span><span class="keyword">val</span> (&lt;=) : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>bool <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(&lt;)"><a href="#val-(&lt;)" class="anchor"></a><code><span><span class="keyword">val</span> (&lt;) : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>bool <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(&gt;)"><a href="#val-(&gt;)" class="anchor"></a><code><span><span class="keyword">val</span> (&gt;) : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>bool <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(&gt;=)"><a href="#val-(&gt;=)" class="anchor"></a><code><span><span class="keyword">val</span> (&gt;=) : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>bool <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(&amp;&amp;)"><a href="#val-(&amp;&amp;)" class="anchor"></a><code><span><span class="keyword">val</span> (&amp;&amp;) : <span><span>bool <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>bool <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>bool <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(||)"><a href="#val-(||)" class="anchor"></a><code><span><span class="keyword">val</span> (||) : <span><span>bool <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>bool <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>bool <a href="#type-t">t</a></span></span></code></div></div><h2 id="functions"><a href="#functions" class="anchor"></a>Functions</h2><div class="odoc-spec"><div class="spec value anchored" id="val-count"><a href="#val-count" class="anchor"></a><code><span><span class="keyword">val</span> count : <span>?distinct:bool <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-expr_list">expr_list</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-count_star"><a href="#val-count_star" class="anchor"></a><code><span><span class="keyword">val</span> count_star : <span>int <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-max"><a href="#val-max" class="anchor"></a><code><span><span class="keyword">val</span> max : <span>?distinct:bool <span class="arrow">&#45;&gt;</span></span> <span><span>int <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-min"><a href="#val-min" class="anchor"></a><code><span><span class="keyword">val</span> min : <span>?distinct:bool <span class="arrow">&#45;&gt;</span></span> <span><span>int <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sum"><a href="#val-sum" class="anchor"></a><code><span><span class="keyword">val</span> sum : <span>?distinct:bool <span class="arrow">&#45;&gt;</span></span> <span><span>int <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-total"><a href="#val-total" class="anchor"></a><code><span><span class="keyword">val</span> total : <span>?distinct:bool <span class="arrow">&#45;&gt;</span></span> <span><span>int <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-group_concat"><a href="#val-group_concat" class="anchor"></a><code><span><span class="keyword">val</span> group_concat : <span>?distinct:bool <span class="arrow">&#45;&gt;</span></span> <span>?sep_by:<span>string <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>string <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>string <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-abs"><a href="#val-abs" class="anchor"></a><code><span><span class="keyword">val</span> abs : <span><span>int <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-changes"><a href="#val-changes" class="anchor"></a><code><span><span class="keyword">val</span> changes : <span>int <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-glob"><a href="#val-glob" class="anchor"></a><code><span><span class="keyword">val</span> glob : <span>pat:<span>string <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>string <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>bool <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-coalesce"><a href="#val-coalesce" class="anchor"></a><code><span><span class="keyword">val</span> coalesce : <span><span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-like"><a href="#val-like" class="anchor"></a><code><span><span class="keyword">val</span> like : <span><span>string <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>pat:<span>string <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>bool <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-max_of"><a href="#val-max_of" class="anchor"></a><code><span><span class="keyword">val</span> max_of : <span><span><span>int <a href="#type-t">t</a></span> list</span> <span class="arrow">&#45;&gt;</span></span> <span>int <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-min_of"><a href="#val-min_of" class="anchor"></a><code><span><span class="keyword">val</span> min_of : <span><span><span>int <a href="#type-t">t</a></span> list</span> <span class="arrow">&#45;&gt;</span></span> <span>int <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-random"><a href="#val-random" class="anchor"></a><code><span><span class="keyword">val</span> random : <span>int <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-lower"><a href="#val-lower" class="anchor"></a><code><span><span class="keyword">val</span> lower : <span><span>string <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>string <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-upper"><a href="#val-upper" class="anchor"></a><code><span><span class="keyword">val</span> upper : <span><span>string <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>string <a href="#type-t">t</a></span></span></code></div></div></div></body></html>