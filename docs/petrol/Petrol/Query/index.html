<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Query (petrol.Petrol.Query)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">petrol</a> &#x00BB; <a href="../index.html">Petrol</a> &#x00BB; Query</nav><header class="odoc-preamble"><h1>Module <code><span>Petrol.Query</span></code></h1><p>Provides an E-DSL for specifying SQL queries in OCaml.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>('ret_ty, 'query_kind) t</span></span></code></div><div class="spec-doc"><p><code>('ret_ty, 'query_tag) t</code> represents an SQL query that returns values of type <code>'ret_ty</code> and is a SQL query of kind <code>'query_kind</code>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-join_op"><a href="#type-join_op" class="anchor"></a><code><span><span class="keyword">type</span> join_op</span><span> = </span></code><ol><li id="type-join_op.LEFT" class="def variant constructor anchored"><a href="#type-join_op.LEFT" class="anchor"></a><code><span>| </span><span><span class="constructor">LEFT</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>LEFT join -- keep rows from the left table where the right column is NULL</p><span class="comment-delim">*)</span></div></li><li id="type-join_op.RIGHT" class="def variant constructor anchored"><a href="#type-join_op.RIGHT" class="anchor"></a><code><span>| </span><span><span class="constructor">RIGHT</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>RIGHT join -- keep rows from the right table where the right column is NULL</p><span class="comment-delim">*)</span></div></li><li id="type-join_op.INNER" class="def variant constructor anchored"><a href="#type-join_op.INNER" class="anchor"></a><code><span>| </span><span><span class="constructor">INNER</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>INNER -- only keep rows for which both the left and right of the join are present.</p><span class="comment-delim">*)</span></div></li></ol></div><div class="spec-doc"><p>Defines the type of join to be used to combine two tables</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-where_fun"><a href="#type-where_fun" class="anchor"></a><code><span><span class="keyword">type</span> <span>('a, 'c) where_fun</span></span><span> = <span><span>bool <a href="../Expr/index.html#type-t">Expr.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'c</span>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'c</span>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span></span><span> <span class="keyword">constraint</span> <span class="type-var">'a</span> = <span>[&lt; `DELETE <span>| `SELECT</span> <span>| `SELECT_CORE</span> <span>| `UPDATE</span> ]</span></span></code></div><div class="spec-doc"><p><code>('a,'c) where_fun</code> defines the type of an SQL function that corresponds to SQL's WHERE clause.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-group_by_fun"><a href="#type-group_by_fun" class="anchor"></a><code><span><span class="keyword">type</span> <span>('a, 'b, 'c) group_by_fun</span></span><span> = <span><span><span class="type-var">'b</span> <a href="../Expr/index.html#type-expr_list">Expr.expr_list</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'c</span>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'c</span>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span></span><span> <span class="keyword">constraint</span> <span class="type-var">'a</span> = <span>[&lt; `SELECT <span>| `SELECT_CORE</span> ]</span></span></code></div><div class="spec-doc"><p><code>('a,'b,'c) group_by_fun</code> defines the type of an SQL function that corresponds to SQL's GROUP BY clause.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-having_fun"><a href="#type-having_fun" class="anchor"></a><code><span><span class="keyword">type</span> <span>('a, 'c) having_fun</span></span><span> = <span><span>bool <a href="../Expr/index.html#type-t">Expr.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'c</span>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'c</span>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span></span><span> <span class="keyword">constraint</span> <span class="type-var">'a</span> = <span>[&lt; `SELECT <span>| `SELECT_CORE</span> ]</span></span></code></div><div class="spec-doc"><p><code>('a,'b,'c) having_fun</code> defines the type of an SQL function that corresponds to SQL's HAVING clause.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-join_fun"><a href="#type-join_fun" class="anchor"></a><code><span><span class="keyword">type</span> <span>('a, 'b, 'd, 'c) join_fun</span></span><span> =
  <span>?op:<a href="#type-join_op">join_op</a> <span class="arrow">&#45;&gt;</span></span>
  <span>on:<span>bool <a href="../Expr/index.html#type-t">Expr.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'b</span>, <span class="type-var">'d</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'c</span>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'c</span>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span></span><span> <span class="keyword">constraint</span> <span class="type-var">'a</span> = <span>[&lt; `SELECT_CORE ]</span> <span class="keyword">constraint</span> <span class="type-var">'d</span> = <span>[&lt; `SELECT_CORE <span>| `SELECT</span> ]</span></span></code></div><div class="spec-doc"><p><code>('a,'b,'c,'d) join_fun</code> defines the type of an SQL function that corresponds to SQL's JOIN clause.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-on_err_fun"><a href="#type-on_err_fun" class="anchor"></a><code><span><span class="keyword">type</span> <span>('a, 'b, 'c) on_err_fun</span></span><span> = <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'c</span>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'c</span>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span></span><span>
  <span class="keyword">constraint</span> <span class="type-var">'a</span> = <span>[&gt; `INSERT <span>| `UPDATE</span> ]</span>
  <span class="keyword">constraint</span> <span class="type-var">'b</span> = <span>[&lt; `ABORT <span>| `FAIL</span> <span>| `IGNORE</span> <span>| `REPLACE</span> <span>| `ROLLBACK</span> ]</span></span></code></div><div class="spec-doc"><p><code>('a,'b,'c) having_fun</code> defines the type of an SQL function that corresponds to SQL's HAVING clause ON ERR.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-select"><a href="#val-select" class="anchor"></a><code><span><span class="keyword">val</span> select : <span><span><span class="type-var">'a</span> <a href="../Expr/index.html#type-expr_list">Expr.expr_list</a></span> <span class="arrow">&#45;&gt;</span></span> <span>from:<a href="../index.html#type-table_name">table_name</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span>[&gt; `SELECT_CORE ]</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>select fields ~from</code> corresponds to the SQL <code>SELECT {fields} FROM {from}</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-update"><a href="#val-update" class="anchor"></a><code><span><span class="keyword">val</span> update : 
  <span>table:<a href="../index.html#type-table_name">table_name</a> <span class="arrow">&#45;&gt;</span></span>
  <span>set:<span><a href="../Expr/index.html#type-wrapped_assign">Expr.wrapped_assign</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(unit, <span>[&gt; `UPDATE ]</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>update ~table ~set</code> corresponds to the SQL <code>UPDATE {set} FROM {table}</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-insert"><a href="#val-insert" class="anchor"></a><code><span><span class="keyword">val</span> insert : 
  <span>table:<a href="../index.html#type-table_name">table_name</a> <span class="arrow">&#45;&gt;</span></span>
  <span>values:<span><a href="../Expr/index.html#type-wrapped_assign">Expr.wrapped_assign</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(unit, <span>[&gt; `INSERT ]</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>insert ~table ~values</code> corresponds to the SQL <code>INSERT {values} INTO {table}</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-delete"><a href="#val-delete" class="anchor"></a><code><span><span class="keyword">val</span> delete : <span>from:<a href="../index.html#type-table_name">table_name</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(unit, <span>[&gt; `DELETE ]</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>delete ~from</code> corresponds to the SQL <code>DELETE FROM {from}</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-where"><a href="#val-where" class="anchor"></a><code><span><span class="keyword">val</span> where : <span><span>(<span>[&lt; `DELETE <span>| `SELECT</span> <span>| `SELECT_CORE</span> <span>| `UPDATE</span> ]</span>, <span class="type-var">'c</span>)</span> <a href="#type-where_fun">where_fun</a></span></span></code></div><div class="spec-doc"><p><code>where by expr</code> corresponds to the SQL <code>{expr} WHERE {by}</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-group_by"><a href="#val-group_by" class="anchor"></a><code><span><span class="keyword">val</span> group_by : <span><span>(<span>[&lt; `SELECT <span>| `SELECT_CORE</span> ]</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-group_by_fun">group_by_fun</a></span></span></code></div><div class="spec-doc"><p><code>group_by fields expr</code> corresponds to the SQL <code>{expr} GROUP BY {fields}</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-having"><a href="#val-having" class="anchor"></a><code><span><span class="keyword">val</span> having : <span><span>(<span>[&lt; `SELECT <span>| `SELECT_CORE</span> ]</span>, <span class="type-var">'c</span>)</span> <a href="#type-having_fun">having_fun</a></span></span></code></div><div class="spec-doc"><p><code>having fields expr</code> corresponds to the SQL <code>{expr} HAVING {fields}</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-join"><a href="#val-join" class="anchor"></a><code><span><span class="keyword">val</span> join : <span><span>(<span>[ `SELECT_CORE ]</span>, <span class="type-var">'b</span>, <span>[&lt; `SELECT_CORE <span>| `SELECT</span> ]</span>, <span class="type-var">'c</span>)</span> <a href="#type-join_fun">join_fun</a></span></span></code></div><div class="spec-doc"><p><code>join ?op ~on oexpr expr</code> corresponds to the SQL <code>{expr} {op} JOIN {oexpr} ON {expr}</code>.</p><p>The ordering of the last two arguments has been chosen to allow easily piping this with another SQL query.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-on_err"><a href="#val-on_err" class="anchor"></a><code><span><span class="keyword">val</span> on_err : 
  <span><span>[ `ABORT <span>| `FAIL</span> <span>| `IGNORE</span> <span>| `REPLACE</span> <span>| `ROLLBACK</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(unit, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(unit, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>on_err err expr</code> corresponds to the SQL <code>{expr} ON ERR {err}</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-limit"><a href="#val-limit" class="anchor"></a><code><span><span class="keyword">val</span> limit : 
  <span><span>int <a href="../Expr/index.html#type-t">Expr.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span>[ `SELECT <span>| `SELECT_CORE</span> ]</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span>[&gt; `SELECT ]</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>limit count expr</code> corresponds to the SQL <code>{expr} LIMIT {count}</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-offset"><a href="#val-offset" class="anchor"></a><code><span><span class="keyword">val</span> offset : 
  <span><span>int <a href="../Expr/index.html#type-t">Expr.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span>[ `SELECT <span>| `SELECT_CORE</span> ]</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <span>[&gt; `SELECT ]</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>offset count expr</code> corresponds to the SQL <code>{expr} OFFSET {fields}</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-order_by"><a href="#val-order_by" class="anchor"></a><code><span><span class="keyword">val</span> order_by : 
  <span>?direction:<span>[ `ASC <span>| `DESC</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../Expr/index.html#type-t">Expr.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'b</span>, <span>[ `SELECT <span>| `SELECT_CORE</span> ]</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'b</span>, <span>[&gt; `SELECT ]</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>order_by ?direction fields expr</code> corresponds to the SQL <code>{expr}
        ORDER BY {direction} {fields}</code>.</p></div></div></div></body></html>